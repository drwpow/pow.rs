---
import Art from '../components/Art.astro';
import Head from '../components/Head.astro';
import Nav from '../components/Nav.astro';
import Tag from '../components/Tag.astro';
import { format } from '../helpers/date.js';

const { content } = Astro.props;
const slug = Astro.url.pathname.replace(/\/blog\//, '');

const SKULL_COLORS = ['#ff0000', '#ffff00', '#0040ff', '#ff00ff', '#00ff00'];
const colorOfTheDay = SKULL_COLORS[Math.floor(Math.random() * SKULL_COLORS.length)];
---

<html lang="en-us">
  <head>
    <Head title={content.title} color={colorOfTheDay} />

    <style lang="scss">
      @use '../styles/element' as *;

      .post-animation {
        display: flex;
        flex-direction: column;
        justify-content: center;
        pointer-events: none;
        transform: translateZ(0);
        z-index: 50;

        @media (min-width: 1200px) {
          position: absolute;
          right: calc(100%);
          top: 2rem;
          width: 16rem;
        }
      }

      .post-body {
        padding: 0;

        @media (min-width: 600px) {
          font-size: var(--u1);
        }

        @media (min-width: 1600px) {
          font-size: var(--u2);
        }

        :global(h2) {
          @include element;

          &::before {
            content: '<h2>';
            line-height: 2.5rem;
          }

          &::after {
            content: '</h2>';
          }
        }

        :global(h3) {
          @include element;

          &::before {
            content: '<h3>';
            line-height: 2.25rem;
          }

          &::after {
            content: '</h3>';
          }
        }

        :global(h4) {
          @include element;

          &::before {
            content: '<h4>';
            line-height: 1.5rem;
          }

          &::after {
            content: '</h4>';
          }
        }

        :global(h5) {
          @include element;

          &::before {
            content: '<h5>';
            line-height: 1.5rem;
          }

          &::after {
            content: '</h5>';
          }
        }
        :global(h6) {
          @include element;

          &::before {
            content: '<h6>';
            line-height: 1.5rem;
          }

          &::after {
            content: '</h6>';
          }
        }

        :global(code) {
          font-size: var(--d2);
        }
      }

      .post-date {
        @include element;

        color: var(--gray-50);
        display: block;
        font-family: 'Arial', sans-serif;
        font-size: var(--d2);
        text-transform: none;

        &::before {
          content: '<time>';
          line-height: 1rem;
        }

        &::after {
          content: '</time>';
          line-height: 1rem;
        }
      }

      .post-description {
        max-width: 28em;
        font-size: var(--u2);
        font-style: italic;
        line-height: 1.4;
        margin-block-end: 0;
        margin-block-start: 0;
      }

      .post-header {
        box-sizing: border-box;
        position: relative;
      }

      .post-tags {
        @include element;

        align-items: center;
        display: flex;
        flex-wrap: wrap;

        &::before {
          content: '<tags>';
          line-height: 2rem;
        }

        &::after {
          content: '</tags>';
          line-height: 2rem;
        }

        :global(> *::before) {
          color: var(--gray-50);
          content: ' / ';
          display: inline-block;
          margin-left: 0.5em;
          margin-right: 0.5em;
        }

        :global(> *:first-of-type::before) {
          content: initial;
        }
      }

      .post-tags-sep {
        margin-left: 0.5rem;
        margin-right: 0.5rem;
      }

      .post-title {
        @include element;

        font-weight: 700;
        font-size: var(--u5);
        margin: 0;
        letter-spacing: -0.01em;

        &::before {
          content: '<title>';
          line-height: 2.75rem;
        }

        &::after {
          content: '</title>';
        }
      }

      :global(.post-yt) {
        position: relative;
        width: 100%;
        height: 0;
        padding-top: 56.25%;

        iframe {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
        }
      }
    </style>
  </head>

  <body>
    <Nav />

    <div class="wrapper">
      <article class="post-body" itemscope itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
          <div class="post-animation"><Art id={slug} /></div>
          {
            content.date && (
              <time class="post-date" datetime={content.date}>
                {format(content.date)}
              </time>
            )
          }
          <h1 class="post-title" itemprop="headline">{content.title}</h1>
          <div class="post-tags">
            {content.tags.map((tag) => <Tag tag={tag} />)}
          </div>
        </header>

        <div itemprop="articleBody">
          <slot />
        </div>
      </article>
    </div>
  </body>
</html>
